//@flow

export default function(chai: Object) {
  chai.Assertion.addMethod('match', function(arg) {
    // allow the match to be provided in the expectation or the match arg.
    let expected, actual;

    if (arg && arg.test) {
      expected = arg;
      actual = this._obj;
    } else {
      expected = this._obj;
      actual = arg;
    }

    if (typeof expected.test !== 'function') {
      throw new Error('Cannot use the .match() method with anything but a sinon matcher.');
    }

    this.assert(
      expected.test(actual),
      'expected #{exp} to match #{act}',
      'expected #{exp} to not match #{act}',
      expected.message,
      actual
    );
  });
}
