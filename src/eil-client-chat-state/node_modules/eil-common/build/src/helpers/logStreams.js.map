{"version":3,"sources":["eil-common/src/helpers/logStreams.js"],"names":["logStreams","bunyanToGelfFix","log","_log","JSON","parse","streams","stream","process","stdout","env","GRAYLOG_SERVER_HOST","GRAYLOG_SERVER_PORT","host","port","options","map","push"],"mappings":";;;;;kBAWwBA,U;;AATxB;;AAEA;AACA,IAAMC,kBAAkB,SAAlBA,eAAkB,CAACC,GAAD,EAAS;AAC/B,MAAMC,OAAO,OAAOD,GAAP,KAAe,QAAf,GAA0BE,KAAKC,KAAL,CAAWH,GAAX,CAA1B,GAA4CA,GAAzD;;AAEA,SAAO,8BAAaC,IAAb,CAAP;AACD,CAJD;;AAMe,SAASH,UAAT,GAAkC;AAC/C,MAAMM,UAAU,CACd;AACEC,YAAQC,QAAQC;AADlB,GADc,CAAhB;;AAMA,MAAID,QAAQE,GAAR,CAAYC,mBAAZ,IAAmCH,QAAQE,GAAR,CAAYE,mBAAnD,EAAwE;AAAA,uBAIjEJ,QAAQE,GAJyD;AAAA,6CAEpEC,mBAFoE;AAAA,QAE/CE,IAF+C,yCAExC,WAFwC;AAAA,8CAGpED,mBAHoE;AAAA,QAG/CE,IAH+C,0CAGxC,IAHwC;;;AAMtE,QAAMC,UAAU;AACdC,WAAKf;AADS,KAAhB;;AAIA,QAAMM,SAAS,2BAAeM,IAAf,EAAqBC,IAArB,EAA2BC,OAA3B,CAAf;AACAT,YAAQW,IAAR,CAAa;AACXV;AADW,KAAb;AAGD;;AAED,SAAOD,OAAP;AACD","file":"eil-common/src/helpers/logStreams.js","sourcesContent":["//@flow\n\nimport {GelfStream, bunyanToGelf} from 'gelf-stream';\n\n// for some reason the log is being passed as JSON string, so it needs to be parsed first.\nconst bunyanToGelfFix = (log) => {\n  const _log = typeof log === 'string' ? JSON.parse(log) : log;\n\n  return bunyanToGelf(_log);\n};\n\nexport default function logStreams(): Array<any> {\n  const streams = [\n    {\n      stream: process.stdout,\n    },\n  ];\n\n  if (process.env.GRAYLOG_SERVER_HOST || process.env.GRAYLOG_SERVER_PORT) {\n    const {\n      GRAYLOG_SERVER_HOST: host = 'localhost',\n      GRAYLOG_SERVER_PORT: port = 5555,\n    } =  process.env;\n\n    const options = {\n      map: bunyanToGelfFix,\n    };\n\n    const stream = new GelfStream(host, port, options);\n    streams.push({\n      stream\n    });\n  }\n\n  return streams;\n}\n"],"sourceRoot":"/source/"}